[Readme](README.md)

---


# Tutorial

Lets say I plan to develop a crossplatform "Snake_3D_Game" with a few Cython modules and a few files written in C.

Install Cengal library:

```bash
python -m pip install cengal
```

Go to new folder you wish to use for your new project.

For example I'll use `~/dev/Snake_3D_Game` under Linux or macOS:

```bash
~/dev$ mkdir Snake_3D_Game
~/dev$ cd ./Snake_3D_Game
```

or `C:\Dev\Snake_3D_Game` under Windows:

```cmd
C:\Dev> mkdir Snake_3D_Game
C:\Dev> cd .\Snake_3D_Game
```

Then I'll create a new project with an appropriate structure by executing `cengal__package__create`:

```bash
~/dev/Snake_3D_Game$ cengal__package__create
```

or:

```cmd
C:\Dev\Snake_3D_Game> cengal__package__create
```

> An alternative way to execute this command is to run `python -m cengal.build_tools.packages.create`

As result I'll be asked a set of project related questions. I'll just hit `Enter` button on an each question in order to use default values:

```
Enter your workspace info.

License file name without extension from the list `https://github.com/spdx/license-list-data/tree/v3.22/json/details` (Default: 'Apache-2.0'):
The selected license: Apache-2.0

Choose a workspace type (Default: '1'):
1. Multi-project with internal python lib
2. Single project
Workspace type:
The selected workspace type: 1

Main project name (Default: 'snake_3d_game'):
The selected main project name: snake_3d_game

Internal python lib name (Default: 'snake_3d_game_lib'):
The selected internal py lib name: snake_3d_game_lib

Author (Default: 'Alex Doe'):
The selected author: Alex Doe

Email (Default: 'alexdoe@localhost.com'):
The selected email: alexdoe@localhost.com

Copyright years range (Default: '2024'):
The selected years range: 2024

Version (Default: '0.1.0'):
The selected version: 0.1.0

Done.
```

As result we will have next directories in our root folder:

```
Snake_3D_Game/
├── __project_template__/
├── docs/
├── global_secrets/
├── path/
├── snake_3d_game/
└── snake_3d_game_lib/
```

Where:

* `docs` - directory for your global documentation
* `global_secrets` - directory for your global secrets
* `path` - directory which you may add to the path for some frequently used scripts
* `snake_3d_game` - directory with your main project
* `snake_3d_game_lib` - directory with your library (used by all your projects). Compilable modules will go there.

## Lets create our first compilable module.

All compilable modules should be created as a part of your internal library

```bash
~/dev/Snake_3D_Game$ cd snake_3d_game_lib
```

```
snake_3d_game_lib/
├── command/
├── docs/
│   └── architecture/
├── examples/
├── LICENSE.md
├── MANIFEST.in.template
├── NOTICE
├── py.typed
├── pyproject.toml
├── README.md
├── requirements.txt
├── setup.py
├── snake_3d_game_lib/
├── snake_3d_game_lib_setup_scripts/
└── THIRD_PARTY_LICENSES.md
```

Lets create module `fast_add`:

```
~/dev/Snake_3D_Game/snake_3d_game_lib$ ./command/scripts__create_module.sh
```

```
Enter `module/submodule` path: fast_add
```

It will create a `fast_add` module inside your `snake_3d_game_lib`. You will be able to import it for example by:

```python
from snake_3d_game_lib.fast_add import *
```

As result a new dir (`snake_3d_game_lib/snake_3d_game_lib/fast_add`) will be created:

```
snake_3d_game_lib/
├── command/
├── docs/
├── examples/
├── LICENSE.md
├── MANIFEST.in.template
├── NOTICE
├── py.typed
├── pyproject.toml
├── README.md
├── requirements.txt
├── setup.py
├── snake_3d_game_lib/
│   ├── __init__.py
│   ├── _template_module/
│   ├── fast_add/
│   └── system/
├── snake_3d_game_lib_setup_scripts/
└── THIRD_PARTY_LICENSES.md
```

Or more precisely:

```
fast_add/
├── __init__.py
└── versions/
    ├── __init__.py
    └── v_0/
        ├── __init__.py
        ├── compilable/
        ├── data/
        ├── development/
        ├── docs/
        ├── fast_add.py
        └── tests/
```

Directory `v_0` is a root of the current version of our `fast_add` module.

> In the future you might add `v_1`, `v_2` ... `v_*` directories with a new version of your module with a refactored API while an old versions of your module will still be accessible for a backward compatibility purposes.

File `fast_add/versions/v_0/fast_add.py` is the main file of our `fast_add` module.

However lets rename `fast_add.py` -> `fast_add__cython.pyx` since we currently want to create Cython module and not interested in Python code anyway.

> Suffix `__cython` is a mandatory part of your Cython modules. Build system uses it in order to distinguish `.c` files generated by Cython from your own `.c` files.

Put next code to your `fast_add__cython.pyx` file

```python
cpdef int fast_add(int a, int b):
    return a + b
```

And adjust `__init__.py` near it since you renamed `fast_add.py`. Cleanup and put next code to this `__init__.py`  (`snake_3d_game_lib/snake_3d_game_lib/fast_add/versions/v_0/__init__.py`):

```python
from .fast_add__cython import *
```

Done. Now your `snake_3d_game_lib` can be build, installed and uploaded to PyPi as a both `sdist` and `wheel` distributions.

Lets now return to your main application which will use our `fast_add()` function.

## Lets use our `fast_add` function in our application

We will continue from our root folder.

```bash
~/dev/Snake_3D_Game$ cd snake_3d_game
```

```
snake_3d_game/
├── __requirements__.py
├── command/
├── docs/
├── main.py
├── requirements.txt
└── tests/
```

Lets prepare venv, compile and install the wheel of our `snake_3d_game_lib`:

```bash
~/dev/Snake_3D_Game/snake_3d_game$ ./command/prepare_environment.sh
```

or

```cmd
C:\Dev\Snake_3D_Game\snake_3d_game> command\prepare_environment.cmd
```

Now you can select `snake_3d_game/venv/bin/python` as your current interpreter for your IDE project and execute your scripts directly from the IDE.

Alternatively lets activate our venv in your terminal:

```bash
~/dev/Snake_3D_Game/snake_3d_game$ . ./command/activate_environment.sh
```

or

```cmd
C:\Dev\Snake_3D_Game\snake_3d_game> command\activate_environment.cmd
```

Cleanup and put next code to your `main.py`:

```python
from snake_3d_game_lib.fast_add import fast_add

print('Answer:', fast_add(1, 2))
```

Run your `main.py`:

```bash
(venv) ~/dev/Snake_3D_Game/snake_3d_game$ python main.py
```

It will return:

```
Answer: 3
```

## Finishing your work

```bash
(venv) ~/dev/Snake_3D_Game/snake_3d_game$ deactivate
```

or

```cmd
(venv) C:\Dev\Snake_3D_Game\snake_3d_game> deactivate
```


## When you will update your `snake_3d_game_lib` with a new code and/or modules

> Or if you've updated requirements of your `snake_3d_game` project

First of all make sure your venv is not activated in your current terminal. Deactivate it otherwise.

Then run:

```bash
~/dev/Snake_3D_Game/snake_3d_game$ . ./command/update_environment.sh
```

or

```cmd
C:\Dev\Snake_3D_Game\snake_3d_game> command\update_environment.cmd
```

It will:
1. update requirements from both:
    1. `snake_3d_game/requirements.txt`
    1. `snake_3d_game/__requirements__.py` - suitable in more complex scenarios
1. build and (re-)install your `snake_3d_game_lib` wheel


---

[Readme](README.md)
